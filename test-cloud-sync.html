<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cloud Sync - Lloyd's GO!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }

        .status-card.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .status-card.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .status-card.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button.success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .button.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }

        .button.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â˜ï¸ Test Cloud Sync</h1>
        
        <div class="status-card" id="connectionStatus">
            <h3>ğŸ”— Statut de connexion</h3>
            <p id="connectionText">VÃ©rification en cours...</p>
        </div>

        <div class="status-card" id="cloudStatus">
            <h3>â˜ï¸ Statut Cloud</h3>
            <p id="cloudText">Initialisation...</p>
        </div>

        <div class="grid">
            <div>
                <h3>ğŸ”§ Configuration</h3>
                <div class="input-group">
                    <label>API Key JSONBin.io</label>
                    <input type="text" id="apiKey" placeholder="Votre clÃ© API">
                </div>
                <button class="button" onclick="setApiKey()">ğŸ”‘ Configurer API Key</button>
                <button class="button success" onclick="testConnection()">ğŸ§ª Tester la connexion</button>
            </div>

            <div>
                <h3>ğŸ“Š DonnÃ©es de test</h3>
                <button class="button" onclick="createTestData()">ğŸ“ CrÃ©er donnÃ©es test</button>
                <button class="button success" onclick="saveToCloud()">ğŸ’¾ Sauvegarder</button>
                <button class="button warning" onclick="loadFromCloud()">ğŸ“¥ Charger</button>
            </div>
        </div>

        <div class="grid">
            <div>
                <h3>ğŸ”„ Synchronisation</h3>
                <button class="button" onclick="syncData()">ğŸ”„ Synchroniser</button>
                <button class="button success" onclick="restoreData()">ğŸ”„ Restaurer</button>
                <button class="button warning" onclick="getStatus()">ğŸ“Š Statut</button>
            </div>

            <div>
                <h3>ğŸ§¹ Nettoyage</h3>
                <button class="button warning" onclick="clearLocalData()">ğŸ—‘ï¸ Effacer local</button>
                <button class="button danger" onclick="clearAllData()">ğŸ’¥ Effacer tout</button>
            </div>
        </div>

        <div class="log" id="log">
            === LOGS CLOUD SYNC ===
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/cloudSync.js"></script>
    <script>
        // Fonctions de test
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `\n[${timestamp}] ${message}`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(elementId, text, type = '') {
            const element = document.getElementById(elementId);
            const textElement = document.getElementById(elementId.replace('Status', 'Text'));
            
            textElement.textContent = text;
            element.className = `status-card ${type}`;
        }

        // VÃ©rifier la connexion internet
        function checkConnection() {
            const isOnline = navigator.onLine;
            updateStatus('connectionStatus', 
                isOnline ? 'âœ… ConnectÃ© Ã  Internet' : 'âŒ Hors ligne', 
                isOnline ? 'success' : 'error'
            );
            log(`Connexion: ${isOnline ? 'En ligne' : 'Hors ligne'}`);
        }

        // VÃ©rifier le statut cloud
        function checkCloudStatus() {
            if (window.cloudSyncManager) {
                const status = window.cloudSyncManager.getSyncStatus();
                updateStatus('cloudStatus', 
                    `API Key: ${status.binId ? 'âœ… ConfigurÃ©e' : 'âŒ Manquante'}\nBin ID: ${status.binId || 'Non crÃ©Ã©'}\nDerniÃ¨re sync: ${status.lastSync || 'Jamais'}`,
                    status.binId ? 'success' : 'warning'
                );
                log(`Statut cloud: ${JSON.stringify(status)}`);
            } else {
                updateStatus('cloudStatus', 'âŒ Cloud Sync Manager non initialisÃ©', 'error');
                log('Erreur: Cloud Sync Manager non disponible');
            }
        }

        // Configurer l'API key
        function setApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('Veuillez entrer une clÃ© API');
                return;
            }

            if (window.cloudSyncManager) {
                window.cloudSyncManager.setApiKey(apiKey);
                log('âœ… API Key configurÃ©e');
                checkCloudStatus();
            } else {
                log('âŒ Cloud Sync Manager non disponible');
            }
        }

        // Tester la connexion
        async function testConnection() {
            log('ğŸ§ª Test de connexion...');
            
            try {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    throw new Error('API Key manquante');
                }

                // Test simple avec JSONBin.io
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': apiKey,
                        'X-Bin-Name': 'test-connection'
                    },
                    body: JSON.stringify({ test: true, timestamp: new Date().toISOString() })
                });

                if (response.ok) {
                    const result = await response.json();
                    log('âœ… Connexion rÃ©ussie - Bin crÃ©Ã©: ' + result.metadata.id);
                    
                    // Supprimer le bin de test
                    await fetch(`https://api.jsonbin.io/v3/b/${result.metadata.id}`, {
                        method: 'DELETE',
                        headers: { 'X-Master-Key': apiKey }
                    });
                    log('ğŸ—‘ï¸ Bin de test supprimÃ©');
                } else {
                    throw new Error('Erreur API: ' + response.status);
                }
            } catch (error) {
                log('âŒ Erreur de connexion: ' + error.message);
            }
        }

        // CrÃ©er des donnÃ©es de test
        function createTestData() {
            const testData = {
                user: {
                    id: 'test-1',
                    firstName: 'Test',
                    lastName: 'Utilisateur',
                    email: 'test@example.com',
                    phone: '+33 1 23 45 67 89',
                    createdAt: new Date().toISOString()
                },
                balances: {
                    bitcoin: 0.5,
                    ethereum: 2.0,
                    bnb: 10.0,
                    solana: 25.0
                },
                transactions: [
                    {
                        id: 'tx-1',
                        type: 'buy',
                        crypto: 'bitcoin',
                        amount: 0.1,
                        price: 45000,
                        date: new Date().toISOString()
                    }
                ],
                kyc: {
                    status: 'pending',
                    submittedAt: new Date().toISOString()
                },
                settings: {
                    notifications: true,
                    theme: 'dark'
                }
            };

            // Sauvegarder localement
            localStorage.setItem('lloyds_test_data', JSON.stringify(testData));
            log('âœ… DonnÃ©es de test crÃ©Ã©es et sauvegardÃ©es localement');
        }

        // Sauvegarder dans le cloud
        async function saveToCloud() {
            log('ğŸ’¾ Sauvegarde dans le cloud...');
            
            try {
                const testData = localStorage.getItem('lloyds_test_data');
                if (!testData) {
                    throw new Error('Aucune donnÃ©e de test trouvÃ©e');
                }

                const data = JSON.parse(testData);
                const success = await window.saveToCloud(
                    data.user,
                    data.balances,
                    data.transactions,
                    data.kyc,
                    data.settings
                );

                if (success) {
                    log('âœ… DonnÃ©es sauvegardÃ©es dans le cloud');
                } else {
                    log('âŒ Ã‰chec de la sauvegarde cloud');
                }
            } catch (error) {
                log('âŒ Erreur sauvegarde: ' + error.message);
            }
        }

        // Charger depuis le cloud
        async function loadFromCloud() {
            log('ğŸ“¥ Chargement depuis le cloud...');
            
            try {
                const cloudData = await window.loadFromCloud();
                if (cloudData) {
                    log('âœ… DonnÃ©es chargÃ©es depuis le cloud');
                    log('DonnÃ©es: ' + JSON.stringify(cloudData, null, 2));
                } else {
                    log('âŒ Aucune donnÃ©e trouvÃ©e dans le cloud');
                }
            } catch (error) {
                log('âŒ Erreur chargement: ' + error.message);
            }
        }

        // Synchroniser les donnÃ©es
        async function syncData() {
            log('ğŸ”„ Synchronisation...');
            
            try {
                const success = await window.syncToCloud(true);
                if (success) {
                    log('âœ… Synchronisation rÃ©ussie');
                } else {
                    log('âŒ Ã‰chec de la synchronisation');
                }
            } catch (error) {
                log('âŒ Erreur synchronisation: ' + error.message);
            }
        }

        // Restaurer les donnÃ©es
        async function restoreData() {
            log('ğŸ”„ Restauration...');
            
            try {
                const success = await window.restoreFromCloud();
                if (success) {
                    log('âœ… DonnÃ©es restaurÃ©es');
                } else {
                    log('âŒ Ã‰chec de la restauration');
                }
            } catch (error) {
                log('âŒ Erreur restauration: ' + error.message);
            }
        }

        // Obtenir le statut
        function getStatus() {
            log('ğŸ“Š RÃ©cupÃ©ration du statut...');
            
            try {
                const status = window.getCloudStatus();
                log('Statut: ' + JSON.stringify(status, null, 2));
            } catch (error) {
                log('âŒ Erreur statut: ' + error.message);
            }
        }

        // Effacer les donnÃ©es locales
        function clearLocalData() {
            localStorage.removeItem('lloyds_test_data');
            localStorage.removeItem('lloyds_local_backup');
            log('ğŸ—‘ï¸ DonnÃ©es locales effacÃ©es');
        }

        // Effacer toutes les donnÃ©es
        function clearAllData() {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir effacer toutes les donnÃ©es ?')) {
                localStorage.clear();
                log('ğŸ’¥ Toutes les donnÃ©es effacÃ©es');
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Initialisation du test Cloud Sync');
            checkConnection();
            
            // Charger l'API key sauvegardÃ©e
            const savedApiKey = localStorage.getItem('lloyds_cloud_api_key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
                log('ğŸ”‘ API Key chargÃ©e depuis le stockage local');
            }
            
            setTimeout(checkCloudStatus, 1000);
        });

        // Ã‰couter les changements de connectivitÃ©
        window.addEventListener('online', () => {
            log('âœ… Connexion Internet rÃ©tablie');
            checkConnection();
        });

        window.addEventListener('offline', () => {
            log('âŒ Connexion Internet perdue');
            checkConnection();
        });
    </script>
</body>
</html>
