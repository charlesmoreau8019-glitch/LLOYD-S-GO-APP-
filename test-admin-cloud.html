<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Cloud - Lloyd's GO!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #007A3D 0%, #005A2C 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }

        .status-card.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .status-card.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .status-card.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button.success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .button.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }

        .button.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .user-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #dee2e6;
        }

        .user-card h3 {
            margin-bottom: 10px;
            color: #007A3D;
        }

        .balance-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
        }

        .balance-input:focus {
            outline: none;
            border-color: #007A3D;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Admin Cloud</h1>
        
        <div class="status-card" id="adminStatus">
            <h3>üîß Statut Administration</h3>
            <p id="adminText">Initialisation...</p>
        </div>

        <div class="status-card" id="cloudStatus">
            <h3>‚òÅÔ∏è Statut Cloud</h3>
            <p id="cloudText">V√©rification...</p>
        </div>

        <div class="grid">
            <div>
                <h3>üîß Tests Administration</h3>
                <button class="button" onclick="testAdminAccess()">üîë Test Acc√®s Admin</button>
                <button class="button success" onclick="testUserManagement()">üë• Test Gestion Utilisateurs</button>
                <button class="button warning" onclick="testBalanceModification()">üí∞ Test Modification Soldes</button>
            </div>

            <div>
                <h3>‚òÅÔ∏è Tests Cloud</h3>
                <button class="button" onclick="testCloudSync()">üîÑ Test Synchronisation</button>
                <button class="button success" onclick="testGlobalAccess()">üåç Test Acc√®s Global</button>
                <button class="button warning" onclick="testRealTimeUpdate()">‚ö° Test Temps R√©el</button>
            </div>
        </div>

        <div class="grid">
            <div>
                <h3>üë§ Utilisateur de Test</h3>
                <div class="user-card">
                    <h4>Admin Test</h4>
                    <label>Solde Total (‚Ç¨):</label>
                    <input type="number" class="balance-input" id="totalBalance" value="1000.00" step="0.01">
                    
                    <label>Bitcoin (‚Ç¨):</label>
                    <input type="number" class="balance-input" id="btcBalance" value="500.00" step="0.01">
                    
                    <label>Ethereum (‚Ç¨):</label>
                    <input type="number" class="balance-input" id="ethBalance" value="300.00" step="0.01">
                    
                    <label>Solde Bancaire (‚Ç¨):</label>
                    <input type="number" class="balance-input" id="bankBalance" value="200.00" step="0.01">
                    
                    <button class="button success" onclick="updateTestUser()">üíæ Mettre √† jour</button>
                </div>
            </div>

            <div>
                <h3>üìä R√©sultats des Tests</h3>
                <div id="testResults">
                    <p>Aucun test effectu√©</p>
                </div>
            </div>
        </div>

        <div class="log" id="log">
            === LOGS TEST ADMIN CLOUD ===
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/userManager.js"></script>
    <script src="js/balanceManager.js"></script>
    <script src="js/cloudSync.js"></script>
    <script>
        // Fonctions de test
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `\n[${timestamp}] ${message}`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(elementId, text, type = '') {
            const element = document.getElementById(elementId);
            const textElement = document.getElementById(elementId.replace('Status', 'Text'));
            
            textElement.textContent = text;
            element.className = `status-card ${type}`;
        }

        function updateTestResults(message, success = true) {
            const resultsDiv = document.getElementById('testResults');
            const color = success ? '#28a745' : '#dc3545';
            const icon = success ? '‚úÖ' : '‚ùå';
            
            resultsDiv.innerHTML += `<p style="color: ${color}; margin: 5px 0;">${icon} ${message}</p>`;
        }

        // Test d'acc√®s admin
        function testAdminAccess() {
            log('üîë Test d\'acc√®s admin...');
            
            try {
                // V√©rifier si les gestionnaires sont disponibles
                const hasUserManager = typeof userManager !== 'undefined';
                const hasBalanceManager = typeof balanceManager !== 'undefined';
                const hasCloudSync = typeof cloudSyncManager !== 'undefined';
                
                if (hasUserManager && hasBalanceManager && hasCloudSync) {
                    updateStatus('adminStatus', '‚úÖ Tous les gestionnaires disponibles', 'success');
                    updateTestResults('Acc√®s admin fonctionnel', true);
                    log('‚úÖ Acc√®s admin r√©ussi');
                } else {
                    throw new Error('Gestionnaires manquants');
                }
            } catch (error) {
                updateStatus('adminStatus', '‚ùå Erreur acc√®s admin', 'error');
                updateTestResults('Erreur acc√®s admin: ' + error.message, false);
                log('‚ùå Erreur acc√®s admin: ' + error.message);
            }
        }

        // Test de gestion des utilisateurs
        function testUserManagement() {
            log('üë• Test de gestion des utilisateurs...');
            
            try {
                // Cr√©er un utilisateur de test
                const testUser = {
                    id: 'test-admin-' + Date.now(),
                    firstName: 'Test',
                    lastName: 'Admin',
                    email: 'test.admin@example.com',
                    phone: '+33 1 23 45 67 89',
                    status: 'active',
                    createdAt: new Date().toISOString()
                };
                
                // Simuler l'ajout d'un utilisateur
                if (typeof userManager !== 'undefined') {
                    userManager.addUser(testUser);
                    log('‚úÖ Utilisateur de test cr√©√©: ' + testUser.id);
                    updateTestResults('Gestion utilisateurs fonctionnelle', true);
                } else {
                    throw new Error('UserManager non disponible');
                }
            } catch (error) {
                updateTestResults('Erreur gestion utilisateurs: ' + error.message, false);
                log('‚ùå Erreur gestion utilisateurs: ' + error.message);
            }
        }

        // Test de modification des soldes
        function testBalanceModification() {
            log('üí∞ Test de modification des soldes...');
            
            try {
                const testUserId = 'test-user-' + Date.now();
                const newBalance = 1500.00;
                
                if (typeof balanceManager !== 'undefined') {
                    balanceManager.updateBalance(testUserId, 'TOTAL_BALANCE_EUR', newBalance);
                    const retrievedBalance = balanceManager.getUserBalances(testUserId);
                    
                    if (retrievedBalance.TOTAL_BALANCE_EUR === newBalance) {
                        log('‚úÖ Modification de solde r√©ussie');
                        updateTestResults('Modification soldes fonctionnelle', true);
                    } else {
                        throw new Error('Solde non mis √† jour correctement');
                    }
                } else {
                    throw new Error('BalanceManager non disponible');
                }
            } catch (error) {
                updateTestResults('Erreur modification soldes: ' + error.message, false);
                log('‚ùå Erreur modification soldes: ' + error.message);
            }
        }

        // Test de synchronisation cloud
        async function testCloudSync() {
            log('üîÑ Test de synchronisation cloud...');
            
            try {
                if (typeof cloudSyncManager !== 'undefined') {
                    const status = cloudSyncManager.getSyncStatus();
                    
                    if (status.isOnline) {
                        log('‚úÖ Synchronisation cloud disponible');
                        updateTestResults('Synchronisation cloud fonctionnelle', true);
                        
                        // Test de synchronisation
                        const testData = {
                            user: { id: 'test-sync', email: 'test@example.com' },
                            balances: { TOTAL_BALANCE_EUR: 1000 },
                            transactions: [],
                            kyc: {},
                            settings: {}
                        };
                        
                        const syncResult = await cloudSyncManager.saveUserData(
                            testData.user,
                            testData.balances,
                            testData.transactions,
                            testData.kyc,
                            testData.settings
                        );
                        
                        if (syncResult) {
                            log('‚úÖ Synchronisation cloud r√©ussie');
                            updateTestResults('Synchronisation cloud r√©ussie', true);
                        } else {
                            log('‚ö†Ô∏è Synchronisation cloud en mode local');
                            updateTestResults('Synchronisation cloud en mode local', true);
                        }
                    } else {
                        log('‚ö†Ô∏è Hors ligne - Synchronisation locale');
                        updateTestResults('Synchronisation locale active', true);
                    }
                } else {
                    throw new Error('CloudSyncManager non disponible');
                }
            } catch (error) {
                updateTestResults('Erreur synchronisation cloud: ' + error.message, false);
                log('‚ùå Erreur synchronisation cloud: ' + error.message);
            }
        }

        // Test d'acc√®s global
        function testGlobalAccess() {
            log('üåç Test d\'acc√®s global...');
            
            try {
                // Simuler un acc√®s depuis diff√©rentes localisations
                const testLocations = ['France', '√âtats-Unis', 'Japon', 'Australie'];
                const currentTime = new Date().toLocaleString('fr-FR');
                
                log('‚úÖ Acc√®s global simul√© pour: ' + testLocations.join(', '));
                updateTestResults('Acc√®s global fonctionnel', true);
                
                // V√©rifier la connectivit√©
                const isOnline = navigator.onLine;
                log(`üåê Connectivit√©: ${isOnline ? 'En ligne' : 'Hors ligne'}`);
                
            } catch (error) {
                updateTestResults('Erreur acc√®s global: ' + error.message, false);
                log('‚ùå Erreur acc√®s global: ' + error.message);
            }
        }

        // Test de mise √† jour temps r√©el
        function testRealTimeUpdate() {
            log('‚ö° Test de mise √† jour temps r√©el...');
            
            try {
                // Simuler une modification en temps r√©el
                const originalBalance = parseFloat(document.getElementById('totalBalance').value);
                const newBalance = originalBalance + 100;
                
                document.getElementById('totalBalance').value = newBalance.toFixed(2);
                
                // Simuler la synchronisation
                setTimeout(() => {
                    log('‚úÖ Mise √† jour temps r√©el simul√©e');
                    updateTestResults('Mise √† jour temps r√©el fonctionnelle', true);
                }, 1000);
                
            } catch (error) {
                updateTestResults('Erreur temps r√©el: ' + error.message, false);
                log('‚ùå Erreur temps r√©el: ' + error.message);
            }
        }

        // Mettre √† jour l'utilisateur de test
        async function updateTestUser() {
            log('üíæ Mise √† jour utilisateur de test...');
            
            try {
                const testUser = {
                    id: 'test-user-admin',
                    firstName: 'Admin',
                    lastName: 'Test',
                    email: 'admin.test@example.com',
                    phone: '+33 1 23 45 67 89',
                    status: 'active'
                };
                
                const balances = {
                    TOTAL_BALANCE_EUR: parseFloat(document.getElementById('totalBalance').value),
                    BTC_EUR: parseFloat(document.getElementById('btcBalance').value),
                    ETH_EUR: parseFloat(document.getElementById('ethBalance').value),
                    EUR_BALANCE: parseFloat(document.getElementById('bankBalance').value)
                };
                
                // Mise √† jour locale
                if (typeof balanceManager !== 'undefined') {
                    Object.keys(balances).forEach(key => {
                        balanceManager.updateBalance(testUser.id, key, balances[key]);
                    });
                }
                
                // Synchronisation cloud
                if (typeof cloudSyncManager !== 'undefined') {
                    await cloudSyncManager.saveUserData(testUser, balances, [], {}, {});
                }
                
                log('‚úÖ Utilisateur de test mis √† jour');
                updateTestResults('Mise √† jour utilisateur r√©ussie', true);
                
            } catch (error) {
                updateTestResults('Erreur mise √† jour: ' + error.message, false);
                log('‚ùå Erreur mise √† jour: ' + error.message);
            }
        }

        // V√©rifier le statut cloud
        function checkCloudStatus() {
            if (typeof cloudSyncManager !== 'undefined') {
                const status = cloudSyncManager.getSyncStatus();
                updateStatus('cloudStatus', 
                    `En ligne: ${status.isOnline ? '‚úÖ' : '‚ùå'} | API Key: ${status.binId ? '‚úÖ' : '‚ùå'} | Derni√®re sync: ${status.lastSync ? new Date(status.lastSync).toLocaleString('fr-FR') : 'Jamais'}`,
                    status.isOnline && status.binId ? 'success' : 'warning'
                );
                log('üìä Statut cloud v√©rifi√©');
            } else {
                updateStatus('cloudStatus', '‚ùå CloudSyncManager non disponible', 'error');
                log('‚ùå CloudSyncManager non disponible');
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Initialisation du test Admin Cloud');
            
            // V√©rifier les statuts
            setTimeout(() => {
                checkCloudStatus();
                testAdminAccess();
            }, 1000);
        });
    </script>
</body>
</html>
